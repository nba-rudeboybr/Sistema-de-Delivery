<!-- src/app/components/order-management/order-management.component.html -->

<div class="order-management-container">
  <div class="header">
    <h1>ğŸ½ï¸ Sistema de Comanda Digital</h1>
    <div class="header-actions">
      <button class="btn btn-primary" (click)="createNewOrder()">
        â• Nova Comanda
      </button>
      <a routerLink="/dishes" class="btn btn-secondary">
        ğŸ“‹ Gerenciar Pratos
      </a>
    </div>
  </div>

  <!-- FormulÃ¡rio para Nova Comanda -->
  <div class="new-order-form" *ngIf="showNewOrderForm">
    <div class="form-card">
      <h3>Nova Comanda</h3>
      <div class="form-group">
        <label for="tableNumber">NÃºmero da Mesa:</label>
        <input 
          type="number" 
          id="tableNumber" 
          [(ngModel)]="newOrder.tableNumber" 
          class="form-control"
          min="1"
        >
      </div>
      <div class="form-group">
        <label for="customerName">Nome do Cliente (opcional):</label>
        <input 
          type="text" 
          id="customerName" 
          [(ngModel)]="newOrder.customerName" 
          class="form-control"
          placeholder="Ex: JoÃ£o Silva"
        >
      </div>
      <div class="form-actions">
        <button class="btn btn-success" (click)="saveNewOrder()" [disabled]="newOrder.tableNumber <= 0">
          âœ… Criar Comanda
        </button>
        <button class="btn btn-secondary" (click)="showNewOrderForm = false">
          âŒ Cancelar
        </button>
      </div>
    </div>
  </div>

  <div class="main-content">
    <!-- Lista de Comandas -->
    <div class="orders-section">
      <h2>ğŸ“‹ Comandas Ativas</h2>
      <div class="orders-grid">
        <div 
          class="order-card" 
          *ngFor="let order of orders"
          [class.selected]="selectedOrder?.id === order.id"
          (click)="selectOrder(order)"
        >
          <div class="order-header">
            <div class="order-info">
              <h3>Mesa {{ order.tableNumber }}</h3>
              <p *ngIf="order.customerName">{{ order.customerName }}</p>
            </div>
            <div class="order-status">
              <span 
                class="status-badge" 
                [style.background-color]="getStatusColor(order.status)"
              >
                {{ getStatusText(order.status) }}
              </span>
            </div>
          </div>
          
          <div class="order-details">
            <p><strong>Itens:</strong> {{ order.items.length }}</p>
            <p><strong>Total:</strong> R$ {{ order.totalAmount.toFixed(2) }}</p>
            <p><strong>Criada em:</strong> {{ order.createdAt | date:'short' }}</p>
          </div>

          <div class="order-actions">
            <select 
              class="status-select" 
              [value]="order.status"
              (change)="updateOrderStatus(order, $event.target.value)"
            >
              <option value="OPEN">Aberta</option>
              <option value="IN_PROGRESS">Em Andamento</option>
              <option value="COMPLETED">Finalizada</option>
              <option value="CANCELLED">Cancelada</option>
            </select>
            <button 
              class="btn btn-danger btn-sm" 
              (click)="deleteOrder(order); $event.stopPropagation()"
            >
              ğŸ—‘ï¸
            </button>
          </div>
        </div>
      </div>
    </div>

    <!-- Ãrea de EdiÃ§Ã£o da Comanda Selecionada -->
    <div class="order-editor" *ngIf="selectedOrder">
      <div class="editor-header">
        <h3>ğŸ“ Editando Comanda - Mesa {{ selectedOrder.tableNumber }}</h3>
        <button class="btn btn-success" (click)="saveOrder()">
          ğŸ’¾ Salvar AlteraÃ§Ãµes
        </button>
      </div>

      <div class="editor-content">
        <!-- Lista de Pratos DisponÃ­veis -->
        <div class="dishes-section">
          <h4>ğŸ½ï¸ Pratos DisponÃ­veis</h4>
          <div class="dishes-grid">
            <div 
              class="dish-card" 
              *ngFor="let dish of dishes"
              (click)="addDishToOrder(dish)"
            >
              <h5>{{ dish.name }}</h5>
              <p>{{ dish.description }}</p>
              <p class="price">R$ {{ dish.price.toFixed(2) }}</p>
            </div>
          </div>
        </div>

        <!-- Itens da Comanda -->
        <div class="order-items-section">
          <h4>ğŸ›’ Itens da Comanda</h4>
          <div class="items-list" *ngIf="selectedOrder.items.length > 0; else noItems">
            <div class="item-card" *ngFor="let item of selectedOrder.items">
              <div class="item-info">
                <h5>{{ item.dishName }}</h5>
                <p>R$ {{ item.unitPrice.toFixed(2) }} cada</p>
              </div>
              <div class="item-controls">
                <div class="quantity-controls">
                  <button 
                    class="btn btn-sm btn-outline" 
                    (click)="updateItemQuantity(item, item.quantity - 1)"
                    [disabled]="item.quantity <= 1"
                  >
                    â–
                  </button>
                  <input 
                    type="number" 
                    [value]="item.quantity" 
                    (change)="updateItemQuantity(item, +$event.target.value)"
                    class="quantity-input"
                    min="1"
                  >
                  <button 
                    class="btn btn-sm btn-outline" 
                    (click)="updateItemQuantity(item, item.quantity + 1)"
                  >
                    â•
                  </button>
                </div>
                <div class="item-total">
                  <strong>R$ {{ item.totalPrice.toFixed(2) }}</strong>
                </div>
                <button 
                  class="btn btn-danger btn-sm" 
                  (click)="removeItemFromOrder(item)"
                >
                  ğŸ—‘ï¸
                </button>
              </div>
            </div>
          </div>
          <ng-template #noItems>
            <div class="no-items">
              <p>Nenhum item adicionado ainda.</p>
              <p>Clique nos pratos acima para adicionar Ã  comanda.</p>
            </div>
          </ng-template>
        </div>

        <!-- Resumo da Comanda -->
        <div class="order-summary">
          <div class="summary-card">
            <h4>ğŸ’° Resumo da Comanda</h4>
            <div class="summary-details">
              <div class="summary-row">
                <span>Subtotal:</span>
                <span>R$ {{ selectedOrder.totalAmount.toFixed(2) }}</span>
              </div>
              <div class="summary-row total">
                <span><strong>Total:</strong></span>
                <span><strong>R$ {{ selectedOrder.totalAmount.toFixed(2) }}</strong></span>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>

